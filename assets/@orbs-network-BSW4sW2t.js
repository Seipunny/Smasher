import"./isomorphic-fetch-CdKVQk21.js";var f=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function S(e){if(e.__esModule)return e;var o=e.default;if(typeof o=="function"){var n=function t(){return this instanceof t?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};n.prototype=o.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})}),n}var u={},m={},w=f&&f.__awaiter||function(e,o,n,t){function s(i){return i instanceof n?i:new n(function(c){c(i)})}return new(n||(n=Promise))(function(i,c){function d(r){try{p(t.next(r))}catch(a){c(a)}}function l(r){try{p(t.throw(r))}catch(a){c(a)}}function p(r){r.done?i(r.value):s(r.value).then(d,l)}p((t=t.apply(e,o||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});m.Nodes=void 0;class j{constructor(){this.nodeIndex=-1,this.committee=new Set,this.topology=[],this.initTime=0}init(o){return w(this,void 0,void 0,function*(){this.nodeIndex=-1,this.committee.clear(),this.topology=[],this.initTime=Date.now();let n=[];try{n=yield(yield fetch(o)).json()}catch(t){throw new Error(`exception in fetch(${o}): ${t}`)}for(const t of n)t.Healthy==="1"&&this.topology.push(t);if(this.topology.length===0)throw new Error(`no healthy nodes in ${o}`)})}getHealthyFor(o){var n;const t=[];for(const s of this.topology)s.Weight>0&&(!((n=s.Mngr)===null||n===void 0)&&n.health[o])&&t.push(s);return t}}m.Nodes=j;const E="@orbs-network/ton-access",_="2.3.3",H="Unthrottled anonymous RPC access to TON blockchain via a robust decentralized network",$="lib/index.js",k="lib/index.js",O="lib/index.d.ts",M=["lib/**/*"],V={test:"env mocha -r ts-node/register test/**/*.ts","test:v2":"env mocha -r ts-node/register test/ton-v2.ts","test:v4":"env mocha -r ts-node/register test/ton-v4.ts",cleanup:"rimraf ./lib","build:web:reg":"esbuild ./lib/web.js --bundle  --sourcemap --target=es2015 --outfile=./dist/index.js","build:web:min":"esbuild ./lib/web.js --bundle  --minify    --target=es2015 --outfile=./dist/index.min.js","build:web":"rimraf ./dist && npm run build:web:reg && npm run build:web:min",build:"npm run lint && rimraf ./lib && tsc && npm run build:web",format:'prettier --write "src/**/*.ts"',lint:"tslint -p tsconfig.json",prepare:"npm run build",prepublishOnly:"npm test && npm run lint",preversion:"npm run lint",version:"npm run format && git add -A src",postversion:"git push && git push --tags"},N={type:"git",url:"git+https://github.com/orbs-network/ton-access.git"},x="yuval@orbs.com",T="MIT",A={url:"https://github.com/orbs-network/ton-access/issues"},R="https://github.com/orbs-network/ton-access#readme",D={"isomorphic-fetch":"^3.0.0"},W={"@types/bn.js":"^5.1.1","@types/chai":"^4.3.4","@types/isomorphic-fetch":"^0.0.36","@types/mocha":"^10.0.0",buffer:"^6.0.3",chai:"^4.3.7",esbuild:"^0.15.14",mocha:"^10.1.0",prettier:"^2.7.1",rimraf:"^3.0.2",ton:"^12.1.3","ton-lite-client":"npm:@truecarry/ton-lite-client@^1.6.1",tonweb:"^0.0.58","ts-node":"^10.9.1",tslib:"^2.4.0",tslint:"^6.1.3","tslint-config-prettier":"^1.18.0"},I={name:E,version:_,description:H,source:$,main:k,types:O,files:M,scripts:V,repository:N,author:x,license:T,bugs:A,homepage:R,dependencies:D,devDependencies:W};var h=f&&f.__awaiter||function(e,o,n,t){function s(i){return i instanceof n?i:new n(function(c){c(i)})}return new(n||(n=Promise))(function(i,c){function d(r){try{p(t.next(r))}catch(a){c(a)}}function l(r){try{p(t.throw(r))}catch(a){c(a)}}function p(r){r.done?i(r.value):s(r.value).then(d,l)}p((t=t.apply(e,o||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0});u.getHttpV4Endpoint=u.getHttpV4Endpoints=P=u.getHttpEndpoint=u.getHttpEndpoints=u.Access=void 0;const C=m;class b{constructor(){this.host="ton.access.orbs.network",this.urlVersion=1,this.nodes=new C.Nodes}init(){return h(this,void 0,void 0,function*(){const o=I;yield this.nodes.init(`https://${this.host}/mngr/nodes?npm_version=${o.version}`)})}makeProtonet(o,n){let t="";switch(o){case"toncenter-api-v2":t+="v2-";break;case"ton-api-v4":t+="v4-";break}return t+=n,t}weightedRandom(o){let n=0;for(const i of o)n+=i.Weight;const t=Math.floor(Math.random()*n);let s=0;for(const i of o){if(t>=s&&t<s+i.Weight)return i;s+=i.Weight}}buildUrls(o,n,t,s){t||(t=""),n||(n="toncenter-api-v2"),o||(o="mainnet"),t.length&&(t=t.replace(/^\/+/,""));const i=[],c=this.makeProtonet(n,o);let d=this.nodes.getHealthyFor(c);if(!(d!=null&&d.length))throw new Error(`no healthy nodes for ${c}`);if(s&&d.length){const l=this.weightedRandom(d);if(l)d=[l];else throw new Error("weightedRandom return empty")}for(const l of d){let p=`https://${this.host}/${l.NodeId}/${this.urlVersion}/${o}/${n}`;t.length&&(p+=`/${t}`),i.push(p)}return i}}u.Access=b;function v(e,o,n,t){return h(this,void 0,void 0,function*(){const s=new b;return yield s.init(),s.buildUrls(e,o,n,t)})}function y(e,o){return h(this,void 0,void 0,function*(){const n=e!=null&&e.network?e.network:"mainnet";let t="jsonRPC";return(e==null?void 0:e.protocol)==="rest"&&(t=""),yield v(n,"toncenter-api-v2",t,o)})}u.getHttpEndpoints=y;function F(e){return h(this,void 0,void 0,function*(){return(yield y(e,!0))[0]})}var P=u.getHttpEndpoint=F;function g(e,o){return h(this,void 0,void 0,function*(){const n=e!=null&&e.network?e.network:"mainnet";if((e==null?void 0:e.protocol)==="json-rpc")throw Error("config.protocol json-rpc is not supported for getTonApiV4Endpoints");return yield v(n,"ton-api-v4","",o)})}u.getHttpV4Endpoints=g;function q(e){return h(this,void 0,void 0,function*(){return(yield g(e,!0))[0]})}u.getHttpV4Endpoint=q;export{G as a,S as b,f as c,P as g};
