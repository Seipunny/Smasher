import{r as M,j as Be}from"./react-CRECuKeQ.js";import{E as Ce,S as Me,C as ve,A as be,V as c,H as Ee,a as Te,b as Z,c as Q,M as S,P as l,d as Ae,e as E,B as J,T as Y,R as Se,f as q,g as Le,h as re,i as ie,Q as Ne}from"./@babylonjs-qWx7j3oM.js";import{C as Pe}from"./cannon-7bExYaCX.js";import{d as U,a as Re}from"./@ton-DtO_0iqI.js";import{g as _e}from"./@orbs-network-BSW4sW2t.js";import{u as Fe}from"./@tonconnect-DPtOsr2_.js";function Oe(){const[d]=Fe();return{sender:{send:async i=>{var a;d.sendTransaction({messages:[{address:i.to.toString(),amount:i.value.toString(),payload:(a=i.body)==null?void 0:a.toBoc().toString("base64")}],validUntil:Date.now()+5*60*1e3})}},connected:d.connected,disconnect:()=>d.disconnect()}}class X{constructor(i,a){this.address=i,this.init=a}static createForDeploy(i,a){const I=U.beginCell().storeUint(a,64).endCell(),v=U.contractAddress(0,{code:i,data:I});return new X(v,{code:i,data:I})}async sendDeploy(i,a){await i.internal(a,{value:"0.01",bounce:!1})}async sendIncrement(i,a){const I=U.beginCell().storeUint(1,32).storeUint(0,64).endCell();await i.internal(a,{value:"0.002",body:I})}async getCounter(i){const{stack:a}=await i.get("counter",[]);return a.readBigNumber()}}function ae(d,i=[]){const[a,I]=M.useState();return M.useEffect(()=>{(async()=>I(await d()))()},i),a}function ke(){return ae(async()=>new Re.TonClient({endpoint:await _e({network:"testnet"})}))}function Ge(){const d=ke(),[i,a]=M.useState(),{sender:I}=Oe(),[z,v]=M.useState(""),k=h=>new Promise(o=>setTimeout(o,h)),p=ae(async()=>{if(!d)return;const h=new X(U.Address.parse("EQBYLTm4nsvoqJRvs_L-IGNKwWs5RKe19HBK_lFadf19FUfb"));return d.open(h)},[d]);M.useEffect(()=>{async function h(){if(!p)return;a(null);const o=await p.getCounter();a(o.toString()),await k(5e3),h()}h()},[p]);const R=async()=>{try{v("Pending"),await(p==null?void 0:p.sendIncrement(I)),v("Success")}catch{v("Failed")}};return{value:i,address:p==null?void 0:p.address.toString(),sendIncrement:R,transactionStatus:z}}const ze=({setConnected:d,disconnect:i})=>{const a=M.useRef(null),I=M.useRef(null),{sendIncrement:z,transactionStatus:v}=Ge(),k=M.useRef(null);return M.useEffect(()=>{if(!a.current||I.current)return;const p=a.current,R=e=>e.preventDefault();document.addEventListener("touchstart",R,{passive:!1}),document.addEventListener("touchmove",R,{passive:!1});const h=new Ce(p,!0),o=new Me(h);o.clearColor=new ve(.141,.141,.141,1);let ee=0;const V=10,x=1,T=2,L=4,u=8,ce=16,b=new be("camera",Math.PI/4,Math.PI/4,20,new c(0,25,0),o);b.mode=1,b.attachControl(p,!0);const H=10,D=()=>{const e=p.width/p.height,t=H/e;b.orthoLeft=-H,b.orthoRight=H,b.orthoTop=t,b.orthoBottom=-t};window.addEventListener("resize",D),D(),b.lowerRadiusLimit=b.upperRadiusLimit=b.radius;const le=new Ee("light",new c(Math.sin(Math.PI/18),1,Math.cos(Math.PI/18)),o);le.intensity=1;const pe=new Te(!0,10,Pe);o.enablePhysics(new c(0,-9.81,0),pe);const de=async(e,t)=>{try{const n=await re.ImportMeshAsync("","./models/","generator.obj");console.log("ImportMeshAsync result:",n);const s=new ie("parentNode",e);s.position=t,s.scaling=new c(2.5,2.5,2.5),n.meshes.forEach((f,xe)=>{console.log(`Imported Mesh ${xe} name: ${f.name}`),f.parent=s});const r=n.meshes.find(f=>f.name==="SM_Bld_Corp_Generator_01_Arms_01");r?(console.log("Found rotating mesh:",r.name),e.registerBeforeRender(()=>{r.addRotation(0,.01,0)})):console.warn("Rotating mesh not found.");const m=n.meshes.find(f=>f.name==="SM_Bld_Corp_Generator_01_Tank_01");m?(console.log("Found rotating mesh:",m.name),e.registerBeforeRender(()=>{m.addRotation(0,-.01,0)})):console.warn("Rotating mesh not found."),console.log("All meshes grouped and placed at position",t)}catch(n){console.error("Error loading mesh:",n)}},he=async(e,t)=>{try{const n=await re.ImportMeshAsync("","./models/","container.obj");console.log("ImportMeshAsync result:",n);const s=new ie("parentNode",e);s.position=t,s.scaling=new c(4.5,4.5,4.5),n.meshes.forEach((r,m)=>{console.log(`Imported Mesh ${m} name: ${r.name}`),r.parent=s})}catch(n){console.error("Error loading mesh:",n)}},te=(e,t,n)=>{const s=S.CreateBox(e,{width:10,height:1,depth:10},o);s.position.y=t,s.physicsImpostor=new l(s,l.BoxImpostor,{mass:0,restitution:.9},o);const r=new Z(`${e}Material`,o);return r.diffuseColor=new Q(.5,.5,.5),r.alpha=.5,s.material=r,s.physicsImpostor.physicsBody.collisionFilterGroup=n,s.physicsImpostor.physicsBody.collisionFilterMask=x|T|L|u,s};te("ground",25,L),te("lowerPlatform",20,u),de(o,new c(0,37.3,0)),he(o,new c(0,9.5,0)),(()=>{const e=S.CreateBox("greenBox",{width:1,height:1,depth:10},o);e.position.y=21,e.position.x=-4.5,e.physicsImpostor=new l(e,l.BoxImpostor,{mass:0,restitution:.9},o);const t=new Z("greenBoxMaterial",o);t.diffuseColor=new Q(0,1,0),e.material=t,e.physicsImpostor.physicsBody.collisionFilterGroup=ce,e.physicsImpostor.physicsBody.collisionFilterMask=x|u;let n=1;const s=.05,r=-4.5,m=4.5;o.onBeforeRenderObservable.add(()=>{e.position.x+=n*s,e.position.x>=m?(e.position.x=m,n=-1):e.position.x<=r&&(e.position.x=r,n=1),o.meshes.forEach(f=>{f.name.startsWith("fragment")&&e.intersectsMesh(f,!1)&&(f.dispose(),ee+=1,P.text=`Balance: ${ee}`)})})})();const ue=()=>{if(o.meshes.filter(t=>t.name==="box"&&!t.isCrushed).length<V){const t=S.CreateBox("box",{size:1},o);t.position=new c(Math.random()*4-2,37,Math.random()*4-2),t.rotation=new c(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),t.physicsImpostor=new l(t,l.BoxImpostor,{mass:2,restitution:.5},o),t.physicsImpostor.physicsBody.collisionFilterGroup=x|T|L|u,t.physicsImpostor.physicsBody.collisionFilterMask=x|T|L|u,t.isCrushed=!1}},G=(e,t,n,s)=>{const r=S.CreateBox("wall",{width:e,height:t,depth:n},o);r.position=s,r.isVisible=!1,r.physicsImpostor=new l(r,l.BoxImpostor,{mass:0,restitution:.9},o),r.physicsImpostor.physicsBody.collisionFilterGroup=x,r.physicsImpostor.physicsBody.collisionFilterMask=x|T|L|u};G(10,40,1,new c(0,20,-5.5)),G(10,40,1,new c(0,20,5.5)),G(1,40,10,new c(-5.5,20,0)),G(1,40,10,new c(5.5,20,0)),G(10,1,10,new c(0,40,0));const j=new Z("pressMaterial",o);j.diffuseColor=new Q(0,0,0);const w=S.CreateBox("leftPress",{width:2,height:3,depth:10},o);w.position=new c(-4.5,27,0),w.material=j,w.physicsImpostor=new l(w,l.BoxImpostor,{mass:0,restitution:.9},o),w.physicsImpostor.physicsBody.collisionFilterGroup=T,w.physicsImpostor.physicsBody.collisionFilterMask=x|T|L|u;const g=S.CreateBox("rightPress",{width:2,height:3,depth:10},o);g.position=new c(4.5,27,0),g.material=j,g.physicsImpostor=new l(g,l.BoxImpostor,{mass:0,restitution:.9},o),g.physicsImpostor.physicsBody.collisionFilterGroup=T,g.physicsImpostor.physicsBody.collisionFilterMask=x|T|L|u;let K=!1;const me=e=>{const n=S.CreateBox("fragment1",{size:.5},o);n.position=new c(e.x-.25,e.y,e.z),n.physicsImpostor=new l(n,l.BoxImpostor,{mass:1,restitution:.5},o),n.physicsImpostor.physicsBody.collisionFilterGroup=u,n.physicsImpostor.physicsBody.collisionFilterMask=x|u;const s=S.CreateBox("fragment2",{size:.5},o);s.position=new c(e.x+.25,e.y,e.z),s.physicsImpostor=new l(s,l.BoxImpostor,{mass:1,restitution:.5},o),s.physicsImpostor.physicsBody.collisionFilterGroup=u,s.physicsImpostor.physicsBody.collisionFilterMask=x|u;const r=m=>{if(m.physicsImpostor){const f=new c((Math.random()-.5)*2,(Math.random()-.5)*2,(Math.random()-.5)*2).normalize().scale(10);m.physicsImpostor.applyImpulse(f,m.getAbsolutePosition())}};r(n),r(s)},oe=()=>{o.meshes.forEach(e=>{const t=e;t.name==="box"&&!t.isCrushed&&t.intersectsMesh(w,!1)&&t.intersectsMesh(g,!1)&&(me(t.position),t.isCrushed=!0,t.dispose())})},fe=()=>{if(w.position.x===-4.5&&g.position.x===4.5){if(K)return;K=!0;const e=.1,t=10,n=Math.abs(-4.5- -.75)/e;let s=0;const r=setInterval(()=>{s<n?(w.position.x+=e,g.position.x-=e,s++,oe()):s<2*n?(w.position.x-=e,g.position.x+=e,s++,oe()):(clearInterval(r),w.position=new c(-4.5,27,0),g.position=new c(4.5,27,0),K=!1)},t)}},$=Ae.CreateFullscreenUI("UI"),y=new E;y.width="200px",y.height="100px",y.horizontalAlignment=E.HORIZONTAL_ALIGNMENT_LEFT,y.verticalAlignment=E.VERTICAL_ALIGNMENT_TOP,y.isVertical=!0,y.top="10px",y.left="10px",$.addControl(y);const _=J.CreateSimpleButton("pressButton","Disconnect");_.width="150px",_.height="40px",_.color="white",_.background="black",_.onPointerDownObservable.add(()=>{i(),d(!1)});const F=J.CreateSimpleButton("pressButton","Buy");F.width="70px",F.height="40px",F.color="white",F.background="black",F.onPointerDownObservable.add(()=>{z()});const N=new Y("statusText",""+v);N.color="white",N.fontSize=24,N.horizontalAlignment=E.HORIZONTAL_ALIGNMENT_LEFT,N.verticalAlignment=E.VERTICAL_ALIGNMENT_TOP,N.top="50px",$.addControl(N),k.current=N;const P=new Y;P.text="Balance: 0",P.color="white",P.fontSize=24,P.width="200px",P.height="40px",y.horizontalAlignment=E.HORIZONTAL_ALIGNMENT_CENTER,y.addControl(P);const A=new Y;A.text=`0/${V}`,A.color="white",A.fontSize=24,A.width="200px",A.height="40px",A.paddingTop="10px",y.addControl(A);const B=new E;B.width="100%",B.height="50px",B.horizontalAlignment=E.HORIZONTAL_ALIGNMENT_CENTER,B.verticalAlignment=E.VERTICAL_ALIGNMENT_BOTTOM,B.isVertical=!1,B.paddingBottom="10px",$.addControl(B);const O=J.CreateSimpleButton("pressButton","Press");O.width="150px",O.height="40px",O.color="white",O.background="black",O.onPointerDownObservable.add(()=>{fe()}),B.addControl(O),B.addControl(F),B.addControl(_);const we=setInterval(ue,1e3),ge=()=>{const e=o.meshes.filter(t=>t.name==="box"&&!t.isCrushed).length;A.text=`${e}/${V}`},ye=()=>{o.meshes.forEach(e=>{const t=e;t.name==="box"&&!t.isCrushed&&e.position.y<=24&&t.dispose()})};h.runRenderLoop(()=>{o.render(),ye(),ge()});const se=()=>{h.resize(),D()};window.addEventListener("resize",se);const C=new Se("splashScreen");C.width="100%",C.height="100%",C.background="#242424",C.alpha=1,C.thickness=0,$.addControl(C);const W=new q("fadeOut","alpha",60,q.ANIMATIONTYPE_FLOAT,q.ANIMATIONLOOPMODE_CONSTANT),Ie=[{frame:0,value:1},{frame:120,value:0}];W.setKeys(Ie);const ne=new Ne;return ne.setEasingMode(Le.EASINGMODE_EASEINOUT),W.setEasingFunction(ne),C.animations=[],C.animations.push(W),o.beginAnimation(C,0,120,!1,1,()=>{C.dispose()}),()=>{clearInterval(we),h.dispose(),window.removeEventListener("resize",se),window.removeEventListener("resize",D),document.removeEventListener("touchstart",R),document.removeEventListener("touchmove",R)}},[d,i]),M.useEffect(()=>{k.current&&(k.current.text=""+v)},[v]),Be.jsx("canvas",{ref:a,style:{width:"100vw",height:"100vh"},tabIndex:-1})},We=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));export{We as S,Ge as a,Oe as u};
